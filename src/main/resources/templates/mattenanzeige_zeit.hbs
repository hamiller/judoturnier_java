<!DOCTYPE html>
<html lang="de">
<header>
  {{> header}}
</header>
<body>
<div class=""><h2>Matte {{matte}} - Runde {{mattenrunde}}</h2> <h1>{{rundenCode}}</h1></div>

<div class="qrcode">
  <img src="data:image/png;base64,{{imageWertungen}}" alt="QRCode Wettkampfwertung"/>
</div>


<span class="freiraum"></span>

<div id="timer-container">
  <h1 id="timer-display" class=""></h1>
  <div class="time-control-buttons">
    <md-filled-button type="button" onclick="sendCommand('start')">Starte Zeit</md-filled-button>
    <md-filled-button type="button" onclick="sendCommand('stop')">Stoppe Zeit</md-filled-button>
    <md-filled-button type="button" onclick="sendCommand('reset')">Zeit zurücksetzen</md-filled-button>
  </div>
</div>
<div>
  {{#each begegnungen}}
    <div class="listeneintrag vs"> {{akuellePaarung}}
      <div class="wettkaempfer name">
        <label class="{{wettkaempfer1.farbe.get}}">{{wettkaempfer1.name}}</label>
      </div>
      <div class="center">vs</div>
      <div class="wettkaempfer name">
        <label class="{{wettkaempfer2.farbe.get}}">{{wettkaempfer2.name}}</label>
      </div>
    </div>
  {{/each}}
</div>
<script src="/js/allgemein.js"></script>
<script>
  // Werte für matte und mattenrunde als JS-Variablen setzen
  const matte = "{{matte}}";
  const mattenrunde = "{{mattenrunde}}";
  // WebSocket-Initialisierung mit zentralem Reconnect und Zeitstand
  const url = "/mattenanzeigews?matte=" + matte;
  initWebSocket(url, function(command) {
    if (command === "start") start();
    if (command === "stop") stop();
    if (command === "reset") reset();
  });

  function sendCommand(command) {
    if (command === 'reset') {
      var sicher = confirm("ACHTUNG\n\nHiermit wird die Wettkampfzeit zurückgesetzt! \n\nSind sie sicher?");
      if (!sicher) return;
    }
    sendCommandToSocket(command, globalSocket);
  }

  const COUNTDOWN = {{kampfzeit}} * 1000; // Millisekunden
  // Init jetzt mit matte und mattenrunde
  init(COUNTDOWN, matte, mattenrunde);
</script>
</body>
</html>
